<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ABS Mental & Behavioural Conditions by State (2022)</title>
  <!-- Vega libraries -->
  <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
  <style>
    body{font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;margin:24px;background:#fcfcfd;color:#111}
    .wrap{max-width:980px;margin:auto}
    #vis{border:1px solid #e6e6e6;border-radius:10px;background:white}
    figcaption{margin-top:8px;font-size:0.9rem;color:#555}
  </style>
</head>
<body>
<div class="wrap">
  <h1>ABS National Health Survey 2022 — Mental & Behavioural Conditions by State</h1>
  <p>Values are persons (’000). Data: ABS Table 2.1. Map: Natural Earth Admin-1.</p>
  <div id="vis"></div>
  <figcaption>Tip: hover a state to see the value. Choropleth uses a sequential scheme.</figcaption>
</div>

<script>
  const spec = {
    "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
    "width": 900, "height": 580,
    "projection": {"type": "equalEarth"},
    "layer": [
      /* ocean background */
      {"mark": {"type": "rect", "fill": "#eef4fa"},
       "width": 900, "height": 580},

      /* graticule */
      {
        "data": {"graticule": {"step": [20, 20]}},
        "mark": {"type": "geoshape", "stroke": "#cdd7e1", "strokeWidth": 0.6, "filled": false}
      },

      /* states choropleth */
      {
        "data": {
          "url": "ne_10m_admin_1_states_provinces.json",
          "format": {"type": "topojson", "feature": "ne_10m_admin_1_states_provinces"}
        },
        "transform": [
          /* join CSV to shapes: properties.name has full state names in NE data */
          {
            "lookup": "properties.name",
            "from": {
              "data": {"url": "mental_health_by_state.csv"},
              "key": "State",
              "fields": ["Value"]
            }
          },
          /* previously filtered by country; not needed when filtering by names */
          /* include only main states/territories */
          {"filter": {"field": "properties.name", "oneOf": [
            "New South Wales", "Victoria", "Queensland", "South Australia",
            "Western Australia", "Tasmania", "Northern Territory", "Australian Capital Territory"
          ]}},
          /* keep only features that have a CSV match */
          {"filter": "isValid(datum.Value) && datum.Value != null"}
        ],
        "mark": {"type": "geoshape", "stroke": "#ffffff", "strokeWidth": 1},
        "encoding": {
          "color": {
            "field": "Value", "type": "quantitative",
            "title": "Persons (’000)",
            "scale": {"scheme": "Blues"}
          },
          "tooltip": [
            {"field": "properties.name", "type": "nominal", "title": "State/Territory"},
            {"field": "Value", "type": "quantitative", "title": "Persons (’000)"}
          ]
        }
      },

      /* neat outline */
      {
        "data": {
          "url": "ne_10m_admin_1_states_provinces.json",
          "format": {"type": "topojson", "feature": "ne_10m_admin_1_states_provinces"}
        },
        "transform": [],
        "mark": {"type": "geoshape", "stroke": "#6c7a89", "strokeWidth": 0.8, "filled": false}
      }
    ],
    "config": {
      "legend": {"orient": "right"},
      "view": {"stroke": null}
    }
  };

  vegaEmbed("#vis", spec, {actions:false});
</script>
</body>
</html>
