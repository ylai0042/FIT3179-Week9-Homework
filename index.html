<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ABS Mental & Behavioural Conditions by State (2022)</title>
  <!-- Vega libraries -->
  <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-tooltip@0"></script>
  <style>
    body{font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;margin:24px;background:#fcfcfd;color:#111}
    .wrap{max-width:980px;margin:auto}
    #vis{border:1px solid #e6e6e6;border-radius:10px;background:white}
    figcaption{margin-top:8px;font-size:0.9rem;color:#555}
  </style>
</head>
<body>
<div class="wrap">
  <h1>ABS National Health Survey 2022 â€” Mental & Behavioural Conditions by State</h1>
  <p>Values are persons ('000). Data: ABS Table 2.1. Map: Natural Earth Admin-1.</p>
  <div id="vis" aria-label="Choropleth of mental and behavioural conditions per 1,000 people by Australian state, NHS 2022."></div>
  <figcaption>
    Source: ABS National Health Survey 2022 (Table 2.1). Visualisation by YishuLAI. 
    Map file: <a href="au_admin_1_states_provinces.json" target="_blank" rel="noopener">TopoJSON definition</a>.
  </figcaption>
</div>

<script>
  const spec = {
    "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
    "width": 900, "height": 580,
    "projection": {"type": "mercator", "center": [134, -28], "scale": 800},
    "layer": [
      /* ocean background (non-interactive) */
      {
        "mark": {"type": "rect", "fill": "#eef4fa", "tooltip": null},
        "width": 900, "height": 580
      },

      /* graticule (non-interactive) */
      {
        "data": {"graticule": {"step": [20, 20]}},
        "mark": {"type": "geoshape", "stroke": "#cdd7e1", "strokeWidth": 0.6, "filled": false, "tooltip": null}
      },

      /* neat outline (non-interactive) */
      {
        "data": {
          "url": "au_admin_1_states_provinces.json",
          "format": {"type": "topojson", "feature": "ne_10m_admin_1_states_provinces"}
        },
        "mark": {"type": "geoshape", "stroke": "#6c7a89", "strokeWidth": 0.8, "filled": false, "tooltip": null}
      },

      /* states choropleth (interactive, tooltips) */
      {
        "data": {
          "url": "au_admin_1_states_provinces.json",
          "format": {"type": "topojson", "feature": "ne_10m_admin_1_states_provinces"}
        },
        "transform": [
          {
            "lookup": "properties.name",
            "from": {
              "data": {"url": "mental_health_by_state.csv", "format": {"type": "csv", "parse": {"Value": "number"}}},
              "key": "State",
              "fields": ["Value"]
            }
          },
          {
            "lookup": "properties.name",
            "from": {
              "data": {"url": "state_population_2022.csv", "format": {"type": "csv", "parse": {"Population": "number"}}},
              "key": "State",
              "fields": ["Population"]
            }
          },
          {"filter": {"field": "properties.name", "oneOf": [
            "New South Wales", "Victoria", "Queensland", "South Australia",
            "Western Australia", "Tasmania", "Northern Territory", "Australian Capital Territory"
          ]}},
          {"calculate": "toNumber(datum.Value)", "as": "ValueNum"},
          {"calculate": "toNumber(datum.Population)", "as": "PopNum"},
          {"calculate": "((datum.ValueNum * 1000) / datum.PopNum) * 1000", "as": "RatePer1000"},
          {"filter": "isValid(datum.RatePer1000) && datum.RatePer1000 != null"}
        ],
        "mark": {"type": "geoshape", "stroke": "#ffffff", "strokeWidth": 1, "cursor": "pointer"},
        "encoding": {
          "color": {
            "field": "RatePer1000", "type": "quantitative",
            "title": "Persons with Mental & Behavioural Conditions per 1,000 (NHS 2022)",
            "scale": {"scheme": "blues", "nice": true, "zero": false}
          },
          "tooltip": [
            {"field": "properties.name", "type": "nominal", "title": "State/Territory"},
            {"field": "ValueNum", "type": "quantitative", "title": "Persons ('000)", "format": ",.1f"},
            {"field": "RatePer1000", "type": "quantitative", "title": "Per 1,000", "format": ",.2f"}
          ]
        }
      }
    ],
    "config": {
      "legend": {"orient": "right", "labelExpr": "format(datum.value, ',.1f')", "titleLimit": 1000, "labelLimit": 1000, "titleFontSize": 12, "titlePadding": 6, "titleLineHeight": 14},
      "view": {"stroke": null}
    }
  };

  vegaEmbed("#vis", spec, {actions:false, tooltip: true, renderer: "svg"});
</script>
</body>
</html>
